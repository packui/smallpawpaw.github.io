<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>J2EE - 单点登录技术 | lbyte</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">J2EE - 单点登录技术</h1><a id="logo" href="/.">lbyte</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">J2EE - 单点登录技术</h1><div class="post-meta">Dec 10, 2018<span> | </span><span class="category"><a href="/categories/J2EE/">J2EE</a></span></div><div class="post-content"><h3 id="0、写在前面"><a href="#0、写在前面" class="headerlink" title="0、写在前面"></a>0、写在前面</h3><p>​    这篇博文，笔者主要讲解了单点登录技术相关知识点，同时也给出了相应的Demo，使用单点登录和配置文件打交道比较多，在这里，笔者会在配置文件中比较重要的部分加上注释进行讲解，方便大家理解与掌握这项技术，尽管我已经努力将篇幅缩短，文章还是偏长，但是读者静下心来认真看完，相信也会有所收获</p>
<h3 id="一、SSO简介"><a href="#一、SSO简介" class="headerlink" title="一、SSO简介"></a>一、SSO简介</h3><p>​    单点登录技术其实就是SSO技术，在多应用系统当中，因为不同的子系统要部署到不同的服务器上，为了避免每次访问不同的系统都进行登录操作，就引入了单点登录这个概念，利用单点登录可以实现相互信任的多应用系统之间的“一处登录，到处通行”与“一处登出、处处登出”的效果</p>
<h3 id="二、SSO原理"><a href="#二、SSO原理" class="headerlink" title="二、SSO原理"></a>二、SSO原理</h3><p>​    SSO原理其实很简单，就是有这么一个认证系统，专门用来验证用户的身份是否合法，当用户进行登录操作时，会访问该系统，然后这个认证系统会返回一个ticket票据信息，作为用户的一个合法凭证。</p>
<p>​    之后，只要是相互信任的子系统，用户就可以凭借这个ticket票据信息进行访问，子系统会拿着这个ticket票据信息去向认证系统进行验证，验证通过，表示该用户已经登录过，则可以进行后续操作</p>
<h3 id="三、CAS简介"><a href="#三、CAS简介" class="headerlink" title="三、CAS简介"></a>三、CAS简介</h3><p>​    CAS是Yale大学的一个开源项目，可以为应用系统提供一种可靠的登录方法，是单点登录的一种主流的解决方案，支持多种不同的客户端，比如Java、PHP、.NET等</p>
<p>​    CAS主要分为CAS Server服务端、CAS Client客户端，服务端主要负责对用户身份进行认证，需要独立进行部署，而客户端主要负责处理受保护资源的访问请求</p>
<h3 id="四、CAS运行流程图解"><a href="#四、CAS运行流程图解" class="headerlink" title="四、CAS运行流程图解"></a>四、CAS运行流程图解</h3><p><img src="/2018/12/10/J2EE - 单点登录技术/p1.PNG" alt="p1"></p>
<p>SSO单点登录运行流程主要有如下几个步骤：</p>
<p>第一步：访问服务：SSO客户端发送请求访问应用系统提供的服务资源</p>
<p>第二步：定向认证：SSO客户端会重定向用户请求到SSO服务器</p>
<p>第三步： 用户认证：SSO服务器对用户身份进行认证</p>
<p>第四步：发放票据：认证通过后，SSO服务器会产生一个随机的Service Ticket票据</p>
<p>第五步：验证票据：SSO服务器验证票据Service Ticket的合法性，验证通过后，就可以允许客户端访问服务</p>
<p>第六步：传输用户信息：SSO服务器验证票据通过后，将用户的认证结果信息返回给客户端</p>
<h3 id="五、CAS-Server的部署"><a href="#五、CAS-Server的部署" class="headerlink" title="五、CAS Server的部署"></a>五、CAS Server的部署</h3><h5 id="1、安装部署六步曲"><a href="#1、安装部署六步曲" class="headerlink" title="1、安装部署六步曲"></a>1、安装部署六步曲</h5><p>第一步：下载CAS软件资源，解压</p>
<p>第二步：进入\cas\source\cas-server-4.0.0-release\cas-server-4.0.0\modules目录</p>
<p>第三步：找到：cas-server-webapp-4.0.0.war </p>
<p>第四步：将cas-server-webapp-4.0.0.war 改名为cas.war</p>
<p>第五步：将cas.war放在一个可以正常工作的tomcat应用服务器的webapps目录下，</p>
<p>第六步：启动tomcat，然后tomcat就会自动解压war包，并且启动CAS服务</p>
<h5 id="2、体验CAS服务"><a href="#2、体验CAS服务" class="headerlink" title="2、体验CAS服务"></a>2、体验CAS服务</h5><p>接下来就可以在浏览器输入：<a href="http://localhost:8080/cas/login" target="_blank" rel="noopener">http://localhost:8080/cas/login</a> 进入CAS登录页面</p>
<p>效果如下：</p>
<p><img src="/2018/12/10/J2EE - 单点登录技术/p2.PNG" alt="p2"></p>
<h5 id="3、输入用户名和密码进行登录，默认提供的登录方式"><a href="#3、输入用户名和密码进行登录，默认提供的登录方式" class="headerlink" title="3、输入用户名和密码进行登录，默认提供的登录方式"></a>3、输入用户名和密码进行登录，默认提供的登录方式</h5><p>用户名：casuser</p>
<p>密码：Mellon</p>
<p>登录成功后效果如下：</p>
<p><img src="/2018/12/10/J2EE - 单点登录技术/p3.PNG" alt="p3"></p>
<p>当然默认的样式肯定不能符合我们的实际需求，所以接下来我们需要知道CAS Server的一些配置才能灵活的运用它，打造适合我们自己的登录服务</p>
<h3 id="六、CAS-Server配置（上）"><a href="#六、CAS-Server配置（上）" class="headerlink" title="六、CAS Server配置（上）"></a>六、CAS Server配置（上）</h3><h5 id="1、修改服务端口号"><a href="#1、修改服务端口号" class="headerlink" title="1、修改服务端口号"></a>1、修改服务端口号</h5><p>（1）首先，先修改Tomcat的服务端口，找到tomcat下的conf/server.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"10000"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）然后，修改CAS的WEB-INF/cas.properties配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.name=http://localhost:10000</span><br></pre></td></tr></table></figure>
<h5 id="2、去除CAS的HTTPS认证"><a href="#2、去除CAS的HTTPS认证" class="headerlink" title="2、去除CAS的HTTPS认证"></a>2、去除CAS的HTTPS认证</h5><p>如果需要使用CAS的HTTPS认证服务，需要购买SSL安全证书，如果在开发测试阶段，我们可以将CAS改成使用HTTP协议</p>
<p>（1）首先。修改CAS的WEB-INF/deployerConfigContext.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"proxyAuthenticationHandler"</span>          <span class="attr">class</span>=<span class="string">"org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">p:httpClient-ref</span>=<span class="string">"httpClient"</span> </span></span><br><span class="line"><span class="tag"> <span class="attr">p:requireSecure</span>=<span class="string">"false"</span>/&gt;</span>   </span><br><span class="line"><span class="comment">&lt;!-- 增加 p:requireSecure="false"，表示不使用安全验证HTTPS --&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）修改CAS的WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ticketGrantingTicketCookieGenerator"</span> <span class="attr">class</span>=<span class="string">"org.jasig.cas.web.support.CookieRetrievingCookieGenerator"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:cookieSecure</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:cookieMaxAge</span>=<span class="string">"86400"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:cookieName</span>=<span class="string">"CASTGC"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:cookiePath</span>=<span class="string">"/cas"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- p:cookieSecure="false"表示不使用安全验证HTTPS、p:cookieMaxAge="86400"表示登录票据的有效时间为1天 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>（3）修改CAS的WEB-INF/spring-configuration/warnCookieGenerator.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"warnCookieGenerator"</span> <span class="attr">class</span>=<span class="string">"org.jasig.cas.web.support.CookieRetrievingCookieGenerator"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:cookieSecure</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:cookieMaxAge</span>=<span class="string">"86400"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:cookieName</span>=<span class="string">"CASPRIVACY"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:cookiePath</span>=<span class="string">"/cas"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- p:cookieSecure="false"表示不使用安全验证HTTPS、p:cookieMaxAge="86400"表示登录票据的有效时间为1天 --&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="七、应用Demo1"><a href="#七、应用Demo1" class="headerlink" title="七、应用Demo1"></a>七、应用Demo1</h3><h5 id="1、搭建一个war工程，在pom-xml配置文件下添加如下内容："><a href="#1、搭建一个war工程，在pom-xml配置文件下添加如下内容：" class="headerlink" title="1、搭建一个war工程，在pom.xml配置文件下添加如下内容："></a>1、搭建一个war工程，在pom.xml配置文件下添加如下内容：</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- cas客户端依赖 --&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">	    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jasig.cas.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">	    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cas-client-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">	    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 其它依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">              <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">source</span>&gt;</span>  </span><br><span class="line">              <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">target</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 指定端口 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">port</span>&gt;</span>10001<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 请求路径 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">  	  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2、在工程的web-xml配置文件中添加如下内容："><a href="#2、在工程的web-xml配置文件中添加如下内容：" class="headerlink" title="2、在工程的web.xml配置文件中添加如下内容："></a>2、在工程的web.xml配置文件中添加如下内容：</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span>	</span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span>  </span><br><span class="line">     	<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span></span><br><span class="line">         org.jasig.cas.client.session.SingleSignOutHttpSessionListener</span><br><span class="line">        <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 配置实现单点登出功能的过滤器 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CAS Single Sign Out Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.jasig.cas.client.session.SingleSignOutFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CAS Single Sign Out Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 配置认证用户身份的过滤器 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CASFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span></span><br><span class="line">            org.jasig.cas.client.authentication.AuthenticationFilter</span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>casServerLoginUrl<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!-- CAS Server端配置的登录页的访问路径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>http://localhost:10000/cas/login<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>serverName<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 当前工程的访问路径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>http://localhost:10001<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CASFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 配置校验Ticket的过滤器 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CAS Validation Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>     			     org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>casServerUrlPrefix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- CAS Server端配置的首页的访问路径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>http://localhost:10000/cas<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>serverName<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!-- 当前工程的访问路径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>http://localhost:10001<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CAS Validation Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 配置负责实现HttpServletRequest请求的过滤器 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过HttpServletRequest的getRemoteUser()方法可以获得SSO登录用户的登录名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CAS HttpServletRequest Wrapper Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>  </span><br><span class="line">            org.jasig.cas.client.util.HttpServletRequestWrapperFilter</span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CAS HttpServletRequest Wrapper Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 配置获取用户登录信息的过滤器 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- AssertionHolder.getAssertion().getPrincipal().getName() --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CAS Assertion Thread Local Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span></span><br><span class="line">            org.jasig.cas.client.util.AssertionThreadLocalFilter</span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CAS Assertion Thread Local Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="3、在当前工程下创建一个JSP页面，然后就可以在JSP中获取用户登录名了"><a href="#3、在当前工程下创建一个JSP页面，然后就可以在JSP中获取用户登录名了" class="headerlink" title="3、在当前工程下创建一个JSP页面，然后就可以在JSP中获取用户登录名了"></a>3、在当前工程下创建一个JSP页面，然后就可以在JSP中获取用户登录名了</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=utf-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"utf-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span>&gt;</span><br><span class="line">&lt;title&gt;SSO&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">Welcome!SSO user!</span><br><span class="line">&lt;%=request.getRemoteUser()%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="4、重复1-3步骤再创建一个war工程"><a href="#4、重复1-3步骤再创建一个war工程" class="headerlink" title="4、重复1-3步骤再创建一个war工程"></a>4、重复1-3步骤再创建一个war工程</h5><h5 id="5、测试单点登录效果"><a href="#5、测试单点登录效果" class="headerlink" title="5、测试单点登录效果"></a>5、测试单点登录效果</h5><p>第一步：启动装载了CAS的Tomcat</p>
<p>第二步：启动上面创建的两个war工程</p>
<p>第三步：浏览器访问工程1：<a href="http://localhost:10001" target="_blank" rel="noopener">http://localhost:10001</a></p>
<p>第四步：发现，页面会自动跳到CAS的登录页面，说明我们的系统和CAS相互绑定了</p>
<p>第五步：在登陆页面输入用户名和密码，页面就会成功跳转到刚刚没有访问成功的工程1的页面</p>
<p>第六步：浏览器访问工程2：<a href="http://localhost:10002，发现即使我们没有登录，也可以成功访问到工程2的受保护资源，说明我们已经实现了相互信任的系统之间的“一处登录，处处通行”的效果" target="_blank" rel="noopener">http://localhost:10002，发现即使我们没有登录，也可以成功访问到工程2的受保护资源，说明我们已经实现了相互信任的系统之间的“一处登录，处处通行”的效果</a></p>
<p>第七步：我们在浏览器地址栏上输入：<a href="http://localhost:10000/cas/logout" target="_blank" rel="noopener">http://localhost:10000/cas/logout</a> ，然后再去访问工程1或工程2，会发现，系统又跳到了CAS登录页面，说明我们已经实现了相互信任的系统之间的“一处登出，处处退出”的效果</p>
<h3 id="八、CAS-Server配置（下）"><a href="#八、CAS-Server配置（下）" class="headerlink" title="八、CAS Server配置（下）"></a>八、CAS Server配置（下）</h3><h5 id="1、修改登出页面（我可不喜欢每次退出登录都跳到CAS提供的默认页面，我想随心所欲的跳，我跳，我跳！）"><a href="#1、修改登出页面（我可不喜欢每次退出登录都跳到CAS提供的默认页面，我想随心所欲的跳，我跳，我跳！）" class="headerlink" title="1、修改登出页面（我可不喜欢每次退出登录都跳到CAS提供的默认页面，我想随心所欲的跳，我跳，我跳！）"></a>1、修改登出页面（我可不喜欢每次退出登录都跳到CAS提供的默认页面，我想随心所欲的跳，我跳，我跳！）</h5><p>​    CAS提供的退出登录后跳转的页面肯定不会是我们实际生产需要的，所以，我们总是会去修改这个登出页面，默认情况下，使用，类似于 <a href="http://localhost:10000/cas/logout" target="_blank" rel="noopener">http://localhost:10000/cas/logout</a> 这种格式的URL就可以实现单点登出，但是CAS也允许我们在这个URL后面再添加URL来实现自定义登出页面</p>
<p>例如：<a href="http://localhost:10000/cas/logout?service=http://www.lbyte.cn" target="_blank" rel="noopener">http://localhost:10000/cas/logout?service=http://www.lbyte.cn</a></p>
<p>但是在使用上面的用法之前，需要修改CAS Server的cas-servlet.xml配置文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logoutAction"</span> <span class="attr">class</span>=<span class="string">"org.jasig.cas.web.flow.LogoutAction"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:servicesManager-ref</span>=<span class="string">"servicesManager"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:followServiceRedirects</span>=<span class="string">"$&#123;cas.logout.followServiceRedirects:true&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 将cas.logout.followServiceRedirects的值改为true，表示开启自定义重定向服务 --&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2、数据源配置（Oh！My-God！我再也不想用casuser和Mellon来登录了！那就看看接下来怎么操作吧…）"><a href="#2、数据源配置（Oh！My-God！我再也不想用casuser和Mellon来登录了！那就看看接下来怎么操作吧…）" class="headerlink" title="2、数据源配置（Oh！My God！我再也不想用casuser和Mellon来登录了！那就看看接下来怎么操作吧…）"></a>2、数据源配置（Oh！My God！我再也不想用casuser和Mellon来登录了！那就看看接下来怎么操作吧…）</h5><p>​    默认情况下，CAS的用户名和密码是casuser和Mellon，所以，我们也总是会修改这个配置，让CAS数据源指向我们的用户表，来进行用户身份认证工作</p>
<p>（1）修改CAS的WEB-INF/deployerConfigContext.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"authenticationManager"</span>          </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.jasig.cas.authentication.PolicyBasedAuthenticationManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- A 这里配置的是一个代理的验证处理器，它在下面进行了定义与设置 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key-ref</span>=<span class="string">"proxyAuthenticationHandler"</span> </span></span><br><span class="line"><span class="tag">                       <span class="attr">value-ref</span>=<span class="string">"proxyPrincipalResolver"</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- B 这里配置的是一个基础的验证处理器，它在下面也进行了定义与设置 --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--&lt;entry key-ref="primaryAuthenticationHandler" </span></span><br><span class="line"><span class="comment">                       value-ref="primaryPrincipalResolver" /&gt;--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 通过阅读这个配置文件，我们可以知道，在这里我们可以使用自己自定义的处理器 --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 自定义验证处理器之前，先将B的基础验证处理器注释掉 --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- C 自定义的验证处理器 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key-ref</span>=<span class="string">"dbAuthHandler"</span> </span></span><br><span class="line"><span class="tag">                       <span class="attr">value-ref</span>=<span class="string">"primaryPrincipalResolver"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"authenticationPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.jasig.cas.authentication.AnyAuthenticationPolicy"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- A 代理的验证处理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"proxyAuthenticationHandler"</span>          </span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">"org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">p:httpClient-ref</span>=<span class="string">"httpClient"</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">p:requireSecure</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"proxyPrincipalResolver"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.jasig.cas.authentication.principal.BasicPrincipalResolver"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- B 基础的验证处理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"primaryAuthenticationHandler"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.jasig.cas.authentication.AcceptUsersAuthenticationHandler"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"users"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 这里指定了用户认证的规则，所以如果使用这个基础的验证处理器，我们只能使用这里配置的用户信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"casuser"</span> <span class="attr">value</span>=<span class="string">"Mellon"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"primaryPrincipalResolver"</span>           </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.jasig.cas.authentication.principal.PersonDirectoryPrincipalResolver"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"attributeRepository"</span> <span class="attr">ref</span>=<span class="string">"attributeRepository"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- C 自定义的验证处理器 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置数据源，包括设置c3p0连接池、JDBC驱动、数据库连接信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>  </span></span><br><span class="line"><span class="tag">			  <span class="attr">p:driverClass</span>=<span class="string">"com.mysql.jdbc.Driver"</span>  </span></span><br><span class="line"><span class="tag">			  <span class="attr">p:jdbcUrl</span>=<span class="string">"jdbc:mysql://127.0.0.1:3306/这写数据库名?characterEncoding=utf8"</span> </span></span><br><span class="line"><span class="tag">			  <span class="attr">p:user</span>=<span class="string">"这里写数据库账号"</span></span></span><br><span class="line"><span class="tag">			  <span class="attr">p:password</span>=<span class="string">"这里写数据库密码"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置用户密码加密工具，笔者这里使用了MD5 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"passwordEncoder"</span>      </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.jasig.cas.authentication.handler.DefaultPasswordEncoder"</span>  </span></span><br><span class="line"><span class="tag">      <span class="attr">c:encodingAlgorithm</span>=<span class="string">"MD5"</span>  </span></span><br><span class="line"><span class="tag">      <span class="attr">p:characterEncoding</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置自定义的验证处理器，包括设置数据源、SQL语句和加密工具 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dbAuthHandler"</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler"</span>  </span></span><br><span class="line"><span class="tag">      <span class="attr">p:dataSource-ref</span>=<span class="string">"dataSource"</span>  </span></span><br><span class="line"><span class="tag">      <span class="attr">p:sql</span>=<span class="string">"select 密码字段 from 用户表 where 用户名字段 = ?"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:passwordEncoder-ref</span>=<span class="string">"passwordEncoder"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>正如读者看到的，我们在自定义验证处理器中，使用了c3p0连接池，而且和数据库打交道，必不可少的还有JDBC驱动，所以要让CAS可以从我们指定的数据表进行用户认证，还需要导入如下相关的jar包（放到cas/WEB-INF/lib目录下就可以）：</p>
<p>c3p0-x.x.x.jar</p>
<p>cas-server-support-jdbc-x.x.x.jar</p>
<p>mysql-connector-java-x.x.x.jar</p>
<h6 id="到这里为止，读者可以改造应用Demo1来试试使用自己数据库的信息来验证CAS单点登录效果了，Just-do-it！！"><a href="#到这里为止，读者可以改造应用Demo1来试试使用自己数据库的信息来验证CAS单点登录效果了，Just-do-it！！" class="headerlink" title="到这里为止，读者可以改造应用Demo1来试试使用自己数据库的信息来验证CAS单点登录效果了，Just do it！！"></a>到这里为止，读者可以改造应用Demo1来试试使用自己数据库的信息来验证CAS单点登录效果了，Just do it！！</h6><h5 id="３、更换CAS-Server登录页面（各种炫酷的登录页，从这里起步，哈哈！帅气或漂亮的你应该要有更漂亮的登录页面的！）"><a href="#３、更换CAS-Server登录页面（各种炫酷的登录页，从这里起步，哈哈！帅气或漂亮的你应该要有更漂亮的登录页面的！）" class="headerlink" title="３、更换CAS Server登录页面（各种炫酷的登录页，从这里起步，哈哈！帅气或漂亮的你应该要有更漂亮的登录页面的！）"></a>３、更换CAS Server登录页面（各种炫酷的登录页，从这里起步，哈哈！帅气或漂亮的你应该要有更漂亮的登录页面的！）</h5><p>在打造我们自己的登录页面之前，还是让我们先来看看默认的CAS登录页面是怎么个样子吧，这里我们就看核心部分代码就好了，这个页面是：casLoginView.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 引入顶部文件 --&gt;</span><br><span class="line">&lt;jsp:directive.include file=<span class="string">"includes/top.jsp"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 表单元素的配置 --&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"box"</span> id=<span class="string">"login"</span>&gt;</span><br><span class="line">  &lt;form:form method=<span class="string">"post"</span> id=<span class="string">"fm1"</span> commandName=<span class="string">"$&#123;commandName&#125;"</span> htmlEscape=<span class="string">"true"</span>&gt;</span><br><span class="line">  &lt;form:errors path=<span class="string">"*"</span> id=<span class="string">"msg"</span> cssClass=<span class="string">"errors"</span> element=<span class="string">"div"</span> htmlEscape=<span class="string">"false"</span> /&gt;</span><br><span class="line">  &lt;h2&gt;&lt;spring:message code="screen.welcome.instructions" /&gt;&lt;/h2&gt;</span><br><span class="line">  &lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"row"</span>&gt;</span><br><span class="line">      &lt;label <span class="keyword">for</span>=<span class="string">"username"</span>&gt;</span><br><span class="line">          &lt;spring:message code=<span class="string">"screen.welcome.label.netid"</span> /&gt;</span><br><span class="line">      &lt;/label&gt;</span><br><span class="line">      &lt;c:choose&gt;</span><br><span class="line">        &lt;c:when test=<span class="string">"$&#123;not empty sessionScope.openIdLocalId&#125;"</span>&gt;</span><br><span class="line">          &lt;strong&gt;$&#123;sessionScope.openIdLocalId&#125;&lt;/strong&gt;</span><br><span class="line">          &lt;input type=<span class="string">"hidden"</span> </span><br><span class="line">                 id=<span class="string">"username"</span> </span><br><span class="line">                 name=<span class="string">"username"</span> </span><br><span class="line">                 value=<span class="string">"$&#123;sessionScope.openIdLocalId&#125;"</span> /&gt;</span><br><span class="line">       &lt;/c:when&gt;</span><br><span class="line">       &lt;c:otherwise&gt;</span><br><span class="line">          &lt;spring:message code=<span class="string">"screen.welcome.label.netid.accesskey"</span></span><br><span class="line">                          <span class="keyword">var</span>=<span class="string">"userNameAccessKey"</span> /&gt;</span><br><span class="line">          &lt;!-- 用户名输入框 --&gt;</span><br><span class="line">          &lt;form:input cssClass=<span class="string">"required"</span> </span><br><span class="line">                      cssErrorClass=<span class="string">"error"</span> </span><br><span class="line">                      id=<span class="string">"username"</span> </span><br><span class="line">                      size=<span class="string">"25"</span> </span><br><span class="line">                      tabindex=<span class="string">"1"</span> </span><br><span class="line">                      accesskey=<span class="string">"$&#123;userNameAccessKey&#125;"</span> </span><br><span class="line">                      path=<span class="string">"username"</span> </span><br><span class="line">                      autocomplete=<span class="string">"off"</span> </span><br><span class="line">                      htmlEscape=<span class="string">"true"</span> /&gt;</span><br><span class="line">        &lt;/c:otherwise&gt;</span><br><span class="line">      &lt;/c:choose&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">    &lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"row"</span>&gt;</span><br><span class="line">      &lt;label <span class="keyword">for</span>=<span class="string">"password"</span>&gt;</span><br><span class="line">          &lt;spring:message code=<span class="string">"screen.welcome.label.password"</span> /&gt;</span><br><span class="line">      &lt;/label&gt;</span><br><span class="line">      &lt;spring:message code=<span class="string">"screen.welcome.label.password.accesskey"</span></span><br><span class="line">                      <span class="keyword">var</span>=<span class="string">"passwordAccessKey"</span> /&gt;</span><br><span class="line">      &lt;!-- 密码输入框 --&gt;</span><br><span class="line">      &lt;form:password cssClass=<span class="string">"required"</span> </span><br><span class="line">                     cssErrorClass=<span class="string">"error"</span> </span><br><span class="line">                     id=<span class="string">"password"</span> </span><br><span class="line">                     size=<span class="string">"25"</span> </span><br><span class="line">                     tabindex=<span class="string">"2"</span> </span><br><span class="line">                     path=<span class="string">"password"</span>  </span><br><span class="line">                     accesskey=<span class="string">"$&#123;passwordAccessKey&#125;"</span> </span><br><span class="line">                     htmlEscape=<span class="string">"true"</span> </span><br><span class="line">                     autocomplete=<span class="string">"off"</span> /&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">    &lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"row check"</span>&gt;</span><br><span class="line">      &lt;input id=<span class="string">"warn"</span> </span><br><span class="line">             name=<span class="string">"warn"</span> </span><br><span class="line">             value=<span class="string">"true"</span> </span><br><span class="line">             tabindex=<span class="string">"3"</span> </span><br><span class="line">             accesskey=<span class="string">"&lt;spring:message code="</span>screen.welcome.label.warn.accesskey<span class="string">" /&gt;"</span></span><br><span class="line">             type=<span class="string">"checkbox"</span> /&gt;</span><br><span class="line">      &lt;label <span class="keyword">for</span>=<span class="string">"warn"</span>&gt;</span><br><span class="line">          &lt;spring:message code=<span class="string">"screen.welcome.label.warn"</span> /&gt;</span><br><span class="line">      &lt;/label&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">    &lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"row btn-row"</span>&gt;</span><br><span class="line">      &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"lt"</span> value=<span class="string">"$&#123;loginTicket&#125;"</span> /&gt;</span><br><span class="line">      &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"execution"</span> value=<span class="string">"$&#123;flowExecutionKey&#125;"</span> /&gt;</span><br><span class="line">      &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_eventId"</span> value=<span class="string">"submit"</span> /&gt;</span><br><span class="line">      &lt;!-- 登录按钮 --&gt;</span><br><span class="line">      &lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">"btn-submit"</span> name=<span class="string">"submit"</span> accesskey=<span class="string">"l"</span> </span><br><span class="line">             value=<span class="string">"&lt;spring:message code="</span>screen.welcome.button.login<span class="string">" /&gt;"</span> </span><br><span class="line">             tabindex=<span class="string">"4"</span> </span><br><span class="line">             type=<span class="string">"submit"</span> /&gt;</span><br><span class="line">      &lt;!-- 重置按钮 --&gt;</span><br><span class="line">      &lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">"btn-reset"</span> name=<span class="string">"reset"</span> accesskey=<span class="string">"c"</span> </span><br><span class="line">             value=<span class="string">"&lt;spring:message code="</span>screen.welcome.button.clear<span class="string">" /&gt;"</span> </span><br><span class="line">             tabindex=<span class="string">"5"</span> </span><br><span class="line">             type=<span class="string">"reset"</span> /&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  &lt;/form:form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 引入底部文件 --&gt;</span><br><span class="line">&lt;jsp:directive.include file=<span class="string">"includes/bottom.jsp"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>—————以下开始改造登录页面了—————-</p>
<p>（1）将自己的登录页login.html文件拷贝到cas\WEB-INF\view\jsp\default\ui目录下，</p>
<p>（2）将使用到的CSS、JS、图片等资源拷贝到cas根目录下</p>
<p>（3）将原来的casLoginView.jsp删除，然后将login.html重命名为casLoginView.jsp</p>
<p>（4）我们注意到原来的casLoginView.jsp文件引入了top.jsp文件，其实这个top.jsp文件里面引入一些其它文件，所以，我们也要在自己的登录页casLoginView.jsp中引入下面的内容：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">"UTF-8"</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html; charset=UTF-8"</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"spring"</span> uri=<span class="string">"http://www.springframework.org/tags"</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"form"</span> uri=<span class="string">"http://www.springframework.org/tags/form"</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br></pre></td></tr></table></figure>
<p>（5）修改form元素</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form:form method=<span class="string">"post"</span> id=<span class="string">"fm1"</span> commandName=<span class="string">"$&#123;commandName&#125;"</span> htmlEscape=<span class="string">"true"</span> </span><br><span class="line">           ...自己的form原本的其它属性... &gt;</span><br><span class="line">    ........</span><br><span class="line">&lt;/form:form&gt;</span><br></pre></td></tr></table></figure>
<p>（6）修改用户名输入框</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;form:input id=<span class="string">"username"</span> </span><br><span class="line">            tabindex=<span class="string">"1"</span> </span><br><span class="line">            accesskey=<span class="string">"$&#123;userNameAccessKey&#125;"</span> </span><br><span class="line">            path=<span class="string">"username"</span> </span><br><span class="line">            autocomplete=<span class="string">"off"</span> </span><br><span class="line">            htmlEscape=<span class="string">"true"</span> </span><br><span class="line">            ...自己的用户名输入框原本的其它属性.../&gt;</span><br></pre></td></tr></table></figure>
<p>（7）修改密码输入框</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;form:password  id=<span class="string">"password"</span> </span><br><span class="line">               tabindex=<span class="string">"2"</span> </span><br><span class="line">               path=<span class="string">"password"</span> </span><br><span class="line">               accesskey=<span class="string">"$&#123;passwordAccessKey&#125;"</span> </span><br><span class="line">               htmlEscape=<span class="string">"true"</span> </span><br><span class="line">               autocomplete=<span class="string">"off"</span> </span><br><span class="line">               ...自己的密码输入框原本的其它属性... /&gt;</span><br></pre></td></tr></table></figure>
<p>（8）修改登录按钮</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"lt"</span> value=<span class="string">"$&#123;loginTicket&#125;"</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"execution"</span> value=<span class="string">"$&#123;flowExecutionKey&#125;"</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_eventId"</span> value=<span class="string">"submit"</span> /&gt;</span><br><span class="line">&lt;input accesskey=<span class="string">"l"</span> value=<span class="string">"立即登录"</span> type=<span class="string">"submit"</span> </span><br><span class="line">       ...自己的登录按钮原本的其它属性... /&gt;</span><br></pre></td></tr></table></figure>
<p>（9）添加错误提示（提示的信息被定义在WEB-INF/classes/messages.properties配置文件，读者有兴趣可以去看看）</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form:errors path=<span class="string">"*"</span> id=<span class="string">"msg"</span> cssClass=<span class="string">"errors"</span> element=<span class="string">"div"</span> htmlEscape=<span class="string">"false"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>（10）修改提示信息的显示语言 - 编辑cas-servlet.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"localeResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.i18n.CookieLocaleResolver"</span> <span class="attr">p:defaultLocale</span>=<span class="string">"zh_CN"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 设置zh_CN为中文显示 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>（11）添加自定义的错误提示信息 - 在WEB-INF/classes/messages_zh_CN.properties配置文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 可以在这个配置文件中添加提示信息等，中文会进行转码，下面的表示：该用户名不存在</span><br><span class="line">authenticationFailure.AccountNotFoundException=\u8BE5\u7528\u6237\u540D\u4E0D\u5B58\u5728</span><br><span class="line"># 输入的密码错误</span><br><span class="line">authenticationFailure.FailedLoginException=\u8F93\u5165\u7684\u5BC6\u7801\u9519\u8BEF</span><br></pre></td></tr></table></figure>
<h6 id="到这里为止，CAS的基本用法以及重要的应用大概都介绍完了，但是，实际开发当中，怎么可能少得了Spring大家族呢，所以，一般来说，我们会将CAS和Spring-Security结合来使用"><a href="#到这里为止，CAS的基本用法以及重要的应用大概都介绍完了，但是，实际开发当中，怎么可能少得了Spring大家族呢，所以，一般来说，我们会将CAS和Spring-Security结合来使用" class="headerlink" title="到这里为止，CAS的基本用法以及重要的应用大概都介绍完了，但是，实际开发当中，怎么可能少得了Spring大家族呢，所以，一般来说，我们会将CAS和Spring Security结合来使用"></a>到这里为止，CAS的基本用法以及重要的应用大概都介绍完了，但是，实际开发当中，怎么可能少得了Spring大家族呢，所以，一般来说，我们会将CAS和Spring Security结合来使用</h6><h3 id="九、CAS与Spring-Security安全框架的整合开发"><a href="#九、CAS与Spring-Security安全框架的整合开发" class="headerlink" title="九、CAS与Spring Security安全框架的整合开发"></a>九、CAS与Spring Security安全框架的整合开发</h3><h5 id="1、首先，创建一个war工程，在pom-xml配置文件中添加如下内容："><a href="#1、首先，创建一个war工程，在pom-xml配置文件中添加如下内容：" class="headerlink" title="1、首先，创建一个war工程，在pom.xml配置文件中添加如下内容："></a>1、首先，创建一个war工程，在pom.xml配置文件中添加如下内容：</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- Spring Security相关依赖 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Spring Security与CAS整合相关依赖 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-cas<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jasig.cas.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cas-client-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 因为Spring Security中已经包含了日志工具，所以要把CAS中的日志工具排除掉 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 其它依赖 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 指定工程访问端口 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">port</span>&gt;</span>10004<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 请求路径 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2、配置工程的web-xml文件"><a href="#2、配置工程的web-xml文件" class="headerlink" title="2、配置工程的web.xml文件"></a>2、配置工程的web.xml文件</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span>	</span><br><span class="line">	<span class="comment">&lt;!-- 可以设置欢迎页 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 解决post乱码问题 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span></span><br><span class="line">            org.springframework.web.filter.CharacterEncodingFilter</span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>	</span><br><span class="line">	<span class="comment">&lt;!-- 加载Spring Security配置文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/spring-security.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span></span><br><span class="line">            org.springframework.web.context.ContextLoaderListener</span><br><span class="line">        <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置Spring Security相关过滤器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span></span><br><span class="line">            org.springframework.web.filter.DelegatingFilterProxy</span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- SpringMVC配置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  	 <span class="comment">&lt;!-- 加载SpringMVC的配置文件 --&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		 <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		 <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实可以发现，CAS和Spring Security整合之后，web.xml文件简单了很多，没有那么多复杂的单点登录、登出等一系列配置信息了，因为这些东西接下来都要交给Spring Security去做了</p>
<h6 id="3、配置Spring-Security的配置文件spring-security-xml，如下：（这个配置文件很重要-）"><a href="#3、配置Spring-Security的配置文件spring-security-xml，如下：（这个配置文件很重要-）" class="headerlink" title="3、配置Spring Security的配置文件spring-security.xml，如下：（这个配置文件很重要*）"></a>3、配置Spring Security的配置文件spring-security.xml，如下：（这个配置文件很重要*）</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans:beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/security"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:beans</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans     </span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">						http://www.springframework.org/schema/security  http://www.springframework.org/schema/security/spring-security.xsd"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 在这里可以放行一些不需要拦截的资源，根据自己项目的实际情况设定，例如如下： --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http</span> <span class="attr">pattern</span>=<span class="string">"/css/**"</span> <span class="attr">security</span>=<span class="string">"none"</span>&gt;</span><span class="tag">&lt;/<span class="name">http</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">http</span> <span class="attr">pattern</span>=<span class="string">"/js/**"</span> <span class="attr">security</span>=<span class="string">"none"</span>&gt;</span><span class="tag">&lt;/<span class="name">http</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--  1 引用CAS入口点 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">http</span> <span class="attr">use-expressions</span>=<span class="string">"false"</span> <span class="attr">entry-point-ref</span>=<span class="string">"casProcessingFilterEntryPoint"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/**"</span> <span class="attr">access</span>=<span class="string">"ROLE_USER"</span>/&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">csrf</span> <span class="attr">disabled</span>=<span class="string">"true"</span>/&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- 3 引用CAS认证过滤器，position 表示将过滤器放在指定的位置上 --&gt;</span>          </span><br><span class="line">        <span class="tag">&lt;<span class="name">custom-filter</span> <span class="attr">ref</span>=<span class="string">"casAuthenticationFilter"</span>  <span class="attr">position</span>=<span class="string">"CAS_FILTER"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 8 定义请求单点登出过滤器 before表示放在指定位置之前，after表示放在指定的位置之后  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">custom-filter</span> <span class="attr">ref</span>=<span class="string">"requestSingleLogoutFilter"</span> <span class="attr">before</span>=<span class="string">"LOGOUT_FILTER"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 7 引用单点登出过滤器  --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">custom-filter</span> <span class="attr">ref</span>=<span class="string">"singleLogoutFilter"</span> <span class="attr">before</span>=<span class="string">"CAS_FILTER"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">http</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  	<span class="comment">&lt;!-- 1 定义CAS的入口点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">beans:bean</span> <span class="attr">id</span>=<span class="string">"casProcessingFilterEntryPoint"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">"org.springframework.security.cas.web.CasAuthenticationEntryPoint"</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!-- 单点登录服务器的登录URL，就是Tomcat中的CAS登录页面的访问路径 --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"loginUrl"</span> <span class="attr">value</span>=<span class="string">"http://localhost:10000/cas/login"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 2 引用Service的配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"serviceProperties"</span> <span class="attr">ref</span>=<span class="string">"serviceProperties"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">beans:bean</span>&gt;</span> </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 2 定义Service的配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">beans:bean</span> <span class="attr">id</span>=<span class="string">"serviceProperties"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"org.springframework.security.cas.ServiceProperties"</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- 单点登录的配置，当前web工程的访问地址/login/cas   --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"service"</span> <span class="attr">value</span>=<span class="string">"http://localhost:10004/login/cas"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">beans:bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 3 定义CAS认证过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">beans:bean</span> <span class="attr">id</span>=<span class="string">"casAuthenticationFilter"</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"org.springframework.security.cas.web.CasAuthenticationFilter"</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!-- 4 引用认证管理器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"authenticationManager"</span> <span class="attr">ref</span>=<span class="string">"authenticationManager"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">beans:bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">&lt;!-- 4 定义认证管理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">authentication-manager</span> <span class="attr">alias</span>=<span class="string">"authenticationManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 5 引用认证提供者 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">authentication-provider</span>  <span class="attr">ref</span>=<span class="string">"casAuthenticationProvider"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">authentication-provider</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">authentication-manager</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">&lt;!-- 5 定义认证提供者 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">beans:bean</span> <span class="attr">id</span>=<span class="string">"casAuthenticationProvider"</span>       </span></span><br><span class="line"><span class="tag">     <span class="attr">class</span>=<span class="string">"org.springframework.security.cas.authentication.CasAuthenticationProvider"</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"authenticationUserDetailsService"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">beans:bean</span>                      <span class="attr">class</span>=<span class="string">"org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper"</span>&gt;</span> </span><br><span class="line">            	<span class="comment">&lt;!-- 6 引用认证类 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">beans:constructor-arg</span> <span class="attr">ref</span>=<span class="string">"userDetailsService"</span> /&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">beans:bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">beans:property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 2 引用Service的配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"serviceProperties"</span> <span class="attr">ref</span>=<span class="string">"serviceProperties"</span>/&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- 配置Ticket票据验证器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"ticketValidator"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">beans:bean</span>                       			 </span></span><br><span class="line"><span class="tag">                   <span class="attr">class</span>=<span class="string">"org.jasig.cas.client.validation.Cas20ServiceTicketValidator"</span>&gt;</span> </span><br><span class="line">                <span class="comment">&lt;!-- Tomcat中CAS的根访问路径 --&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">beans:constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"http://localhost:10000/cas"</span>/&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">beans:bean</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">beans:property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"key"</span> <span class="attr">value</span>=<span class="string">"an_id_for_this_auth_provider_only"</span>/&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">beans:bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 6 定义认证类, class值是UserDetailsServiceImpl类的全路径--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">beans:bean</span> <span class="attr">id</span>=<span class="string">"userDetailsService"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"工程包名.service.impl.UserDetailsServiceImpl"</span>/&gt;</span>  </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 7 定义单点登出过滤器  --&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">beans:bean</span> <span class="attr">id</span>=<span class="string">"singleLogoutFilter"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"org.jasig.cas.client.session.SingleSignOutFilter"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 8 定义请求单点登出过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">beans:bean</span> <span class="attr">id</span>=<span class="string">"requestSingleLogoutFilter"</span>             <span class="attr">class</span>=<span class="string">"org.springframework.security.web.authentication.logout.LogoutFilter"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置单点登出后跳转的页面 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:constructor-arg</span> <span class="attr">value</span>=<span class="string">"http://localhost:10000/cas/logout?service=http://www.lbyte.cn"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:constructor-arg</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">beans:bean</span>                <span class="attr">class</span>=<span class="string">"org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">beans:constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置单点登出的访问路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"filterProcessesUrl"</span> <span class="attr">value</span>=<span class="string">"/logout/cas"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">beans:bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans:beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="4、创建一个UserDetailsServiceImpl实现类（认证类）"><a href="#4、创建一个UserDetailsServiceImpl实现类（认证类）" class="headerlink" title="4、创建一个UserDetailsServiceImpl实现类（认证类）"></a>4、创建一个UserDetailsServiceImpl实现类（认证类）</h5><p>​    通常将这个类作为认证类，通过这个类可以得到登录用户的用户名，然后就可以使用得到的用户名进行后续的业务开发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">		<span class="comment">// 构建一个角色集合</span></span><br><span class="line">		List&lt;GrantedAuthority&gt; authorities=<span class="keyword">new</span> ArrayList();</span><br><span class="line">		authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">"ROLE_USER"</span>));</span><br><span class="line">        <span class="comment">// 返回登录用户的一些信息</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> User(username, <span class="string">""</span> , authorities);		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5、获取登录用户的用户名-下面创建一个控制器类UserController简单的测试一下"><a href="#5、获取登录用户的用户名-下面创建一个控制器类UserController简单的测试一下" class="headerlink" title="5、获取登录用户的用户名  - 下面创建一个控制器类UserController简单的测试一下"></a>5、获取登录用户的用户名  - 下面创建一个控制器类UserController简单的测试一下</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 获取登录用户的用户名</span></span><br><span class="line">		String name = SecurityContextHolder.getContext().getAuthentication().getName();</span><br><span class="line">        <span class="comment">// 我们只需要将程序运行起来</span></span><br><span class="line">        <span class="comment">// 然后在浏览器地址栏输入：http://localhost:10004/user/login.do</span></span><br><span class="line">        <span class="comment">// 就可以在控制台看到用户名被打印出来了，说明我们已经实现了这个功能</span></span><br><span class="line">        <span class="comment">// 拿到单点登录的用户名，就意味着可以进行后续更多的操作了~</span></span><br><span class="line">		System.out.println(name);	</span><br><span class="line">	&#125;	</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="6、单点登出"><a href="#6、单点登出" class="headerlink" title="6、单点登出"></a>6、单点登出</h5><p>​    可以在自己的系统当中，给某个按钮或链接设置访问路径为spring-security.xml配置文件中设置的filterProcessesUrl的值即可，例如：使用上面所示的配置文件，则可以像下面一样使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/logout/cas"</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（完结！）"><a href="#（完结！）" class="headerlink" title="（完结！）"></a>（完结！）</h4></div><div class="tags"></div><div class="post-nav"><a class="next" href="/2018/11/29/算法 - 二叉树 - 完全二叉树转大根堆/">算法 - 二叉树 - 完全二叉树转大根堆</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/J2EE/">J2EE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jsp/">jsp</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式消息中间件/">分布式消息中间件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/多线程/">多线程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/小项目/">小项目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发工具/">开发工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机/">计算机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/问题诊所/">问题诊所</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/10/J2EE - 单点登录技术/">J2EE - 单点登录技术</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/29/算法 - 二叉树 - 完全二叉树转大根堆/">算法 - 二叉树 - 完全二叉树转大根堆</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/19/JVM - Java虚拟机内存区域/">JVM - Java虚拟机内存区域</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/16/算法 - 链表系列 - 寻找链表的倒数第N个结点/">算法 - 链表系列 - 寻找链表的倒数第N个结点</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/11/算法 - 链表系列 - 链表成环问题/">算法 - 链表系列 - 链表成环问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/06/算法 - 对数器/">算法 - 对数器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/02/算法 - 二维数组中的查找问题/">算法 - 二维数组中的查找问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/01/算法 - 重建二叉树/">算法 - 重建二叉树</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/30/算法 - 查找系列 - 查找中位数/">算法 - 查找系列 - 查找中位数</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/22/J2EE - 前后端分离模式下的跨域访问/">J2EE - 前后端分离模式下的JS跨域访问</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">lbyte.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>